- name: "install apache and php"
  apt:
    name:
      - curl
      - unzip
      - sendmail
      - apache2
      - php7.1-common
      - php7.1-cli
      - php7.1-dev
      - php7.1-gd
      - php7.1-curl
      - php7.1-json
      - php7.1-opcache
      - php7.1-xml
      - php7.1-mbstring
      - php7.1-pdo
      - php7.1-mysql
      - php-apcu
      - libpcre3-dev
      - libapache2-mod-php7.1
    state: present

- name: "Disable the firewall (since this is for local dev only)."
      service:
        name: ufw
        state: stopped
    - name: "Start Apache, MySQL, and PHP."
      service:
        name: "{{ item }}"
        state: started
        enabled: yes
      loop:
        - apache2
        - mysql
    - name: "Enable Apache rewrite module (required for Drupal)."
      apache2_module:
        name: rewrite
        state: present
      notify: "restart apache"
    - name: "Add Apache virtualhost for Drupal 8."
      template:
        src: "templates/drupal.test.conf.j2"
        dest: "/etc/apache2/sites-available/{{ domain }}.test.conf"
        owner: root
        group: root
        mode: 0644
      notify: "restart apache"
